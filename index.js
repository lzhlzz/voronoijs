$(document).ready(function(){var t,e,n,r,o,a,u,i,l,c,f,s,d,v,h,p;return t=1e-10,e=function(t){return t.z=Math.pow(t.x,2)+Math.pow(t.y,2)-t.value,t},n=function(){var t;return t=d3.max(d.map(function(t){return t.value})),d.forEach(function(e){return e.value=e.value/t*o}),d.map(e)},r=document.getElementById("bound").getBoundingClientRect(),o=r.width,a=r.height,u=d3.select("#svg").attr({width:o+"px",height:a+"px",viewBox:[0,0,o,a].join(" ")}),i=[{x:-o,y:-a,boundary:!0},{x:-o,y:2*a,boundary:!0},{x:2*o,y:-a,boundary:!0},{x:2*o,y:2*a,boundary:!0}].map(function(e){return e.boundary=!0,e.value=t,e}).map(e),l=function(){var t,n,r,i,l,c,f,v,y,x,g,m,w=[];for(t=s.polygons,n=[{x:10,y:10},{x:o-10,y:10},{x:o-10,y:a-10},{x:10,y:a-10}],r=60,i=[],l=0;r>l;++l)c=l,i.push({x:1*(o/2+o/2*Math.cos(2*Math.PI*c/r)),y:1*(a/2+a/2*Math.sin(2*Math.PI*c/r))});if(n=i,t=t.map(function(t){return Voronoi.Polygon.intersect(n,t)}),f=d3.scale.linear().domain([0,o]).range([0,o]),v=d3.scale.linear().domain([0,a]).range([0,a]),y=u.selectAll("path.voronoi").data(t),y.enter().append("path").attr({"class":"voronoi"}),y.exit().remove(),u.selectAll("path.voronoi").attr({d:function(t){var e;return t.length?["M"+f(t[0].x)+" "+v(t[0].y)].concat(function(){var n,r,o=[];for(n=1,r=t.length;r>n;++n)e=n,o.push("L"+f(t[e].x)+" "+v(t[e].y));return o}(),["L"+f(t[0].x)+" "+v(t[0].y)].join(" ")):""},fill:"rgba(0,0,0,0.1)",stroke:"#000"}).on("mouseover",function(){return d3.select(this).attr({fill:"rgba(0,0,0,0.5)"})}).on("mouseout",function(){return d3.select(this).attr({fill:"rgba(0,0,0,0.1)"})}),x=u.selectAll("circle.site").data(d),x.enter().append("circle").attr({"class":"site"}),x.exit().remove(),u.selectAll("circle.site").attr({cx:function(t){return f(t.x)},cy:function(t){return v(t.y)},r:function(t){return Math.sqrt(t.value)},fill:"#fff",stroke:"#000",opacity:function(){return 1}}).on("click",function(t,e){var n;return n=d[e],n.value=Math.pow(Math.sqrt(n.value)+10,2),n.z=Math.pow(n.x,2)+Math.pow(n.y,2)-n.value,h(),d3.event.preventDefault(),d3.event.stopPropagation(),d3.returnValue=!1,d3.cancelBubble=!0}),p){for(g=t.map(function(t){return Voronoi.Polygon.center(t)}),l=0,m=g.length-4;m>l;++l)c=l,d[c]&&t[c].length&&!d[c].boundary&&(d[c].x+=.01*(g[c].x-d[c].x),d[c].y+=.01*(g[c].y-d[c].y),w.push(e(d[c])));return w}},u.on("click",function(){var t,n,o;return t=[d3.event.clientX-r.left,d3.event.clientY-r.top],n=t[0],o=t[1],d.push(e({x:n,y:o,value:30})),h()}),c=[],u.on("mousemove",function(){var t,n,o;return t=[d3.event.clientX-r.left,d3.event.clientY-r.top],n=t[0],o=t[1],c=e({x:n,y:o,value:30}),h()}),f=[],s=null,d=[],d=function(){var t,e=[];for(t=0;20>t;++t)v=t,e.push({x:o/4+o/2*Math.random(),y:a/4+a/2*Math.random(),value:30+30*Math.random()});return e}().map(function(t){return e(t)}),h=function(){var t,e,n,r,o,a;for(t=(new Date).getTime(),f=JSON.parse(JSON.stringify(d.concat(c,i))),e=(new Date).getTime(),s=new Voronoi.Convex(f),n=(new Date).getTime();s.idx<s.pts.length;)s.iterate();return r=(new Date).getTime(),s.grid(),o=(new Date).getTime(),l(),a=(new Date).getTime(),console.log(e-t,n-e,r-n,o-r,a-o)},h(),p=!1,setTimeout(function(){return p=!0,setInterval(function(){return h()},100)},200)});