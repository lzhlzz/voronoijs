$(document).ready(function(){var t,e,n,r,o,a,u,i,l,c,f,s,d,v,p,h,y,m,x,g,w,M;for(t=1e-10,e=function(t){return t.z=Math.pow(t.x,2)+Math.pow(t.y,2)-t.value,t},n=function(){var t;return t=d3.max(m.map(function(t){return t.value})),m.forEach(function(e){return e.value=e.value/t*o}),m.map(e)},r=document.getElementById("bound").getBoundingClientRect(),o=r.width,a=r.height,u=d3.select("#svg").attr({width:o+"px",height:a+"px",viewBox:[0,0,o,a].join(" ")}),i=[{x:-o,y:-a,boundary:!0},{x:-o,y:2*a,boundary:!0},{x:2*o,y:-a,boundary:!0},{x:2*o,y:2*a,boundary:!0}].map(function(e){return e.boundary=!0,e.value=t,e}).map(e),l=[{x:10,y:10},{x:o-10,y:10},{x:o-10,y:a-10},{x:10,y:a-10}],c=20,f=[],s=0;c>s;++s)d=s,f.push({x:1*(o/2+o/2*Math.cos(2*Math.PI*d/c)),y:1*(a/2+a/2*Math.sin(2*Math.PI*d/c))});return l=f,v=function(){var t,n,r,i,c,f,s,d,v,p=[];if(t=y.polygons,t=t.map(function(t){return Voronoi.Polygon.intersect(l,t)}),n=d3.scale.linear().domain([0,o]).range([0,o]),r=d3.scale.linear().domain([0,a]).range([0,a]),i=u.selectAll("path.voronoi").data(t),i.enter().append("path").attr({"class":"voronoi"}),i.exit().remove(),u.selectAll("path.voronoi").attr({d:function(t){var e;return t.length?["M"+n(t[0].x)+" "+r(t[0].y)].concat(function(){var o,a,u=[];for(o=1,a=t.length;a>o;++o)e=o,u.push("L"+n(t[e].x)+" "+r(t[e].y));return u}(),["L"+n(t[0].x)+" "+r(t[0].y)].join(" ")):""},fill:"rgba(0,0,0,0.1)",stroke:"#000"}).on("mouseover",function(){return d3.select(this).attr({fill:"rgba(0,0,0,0.5)"})}).on("mouseout",function(){return d3.select(this).attr({fill:"rgba(0,0,0,0.1)"})}),c=u.selectAll("circle.site").data(m),c.enter().append("circle").attr({"class":"site"}),c.exit().remove(),u.selectAll("circle.site").attr({cx:function(t){return n(t.x)},cy:function(t){return r(t.y)},r:function(t){return Math.sqrt(t.value)},fill:"#fff",stroke:"#000",opacity:function(){return 1}}).on("click",function(t,e){var n;return n=m[e],n.value=Math.pow(Math.sqrt(n.value)+10,2),n.z=Math.pow(n.x,2)+Math.pow(n.y,2)-n.value,w(),d3.event.preventDefault(),d3.event.stopPropagation(),d3.returnValue=!1,d3.cancelBubble=!0}),M){for(f=t.map(function(t){return Voronoi.Polygon.center(t)}),s=0,d=f.length-4;d>s;++s)v=s,m[v]&&t[v].length&&!m[v].boundary&&(m[v].x+=.01*(f[v].x-m[v].x),m[v].y+=.01*(f[v].y-m[v].y),p.push(e(m[v])));return p}},u.on("click",function(){var t,n,o;return t=[d3.event.clientX-r.left,d3.event.clientY-r.top],n=t[0],o=t[1],m.push(e({x:n,y:o,value:30})),w()}),p=[],u.on("mousemove",function(){var t,n,o;return t=[d3.event.clientX-r.left,d3.event.clientY-r.top],n=t[0],o=t[1],p=e({x:n,y:o,value:30}),w()}),h=[],y=null,m=[],m=function(){var t,e=[];for(t=0;100>t;++t)d=t,e.push({x:o*Math.random(),y:a*Math.random(),value:30+30*Math.random()});return e}().map(function(t){return e(t)}),x=[0,0,0,0,0],g=0,w=function(){var t,e,n,r,o,a;for(t=(new Date).getTime(),h=JSON.parse(JSON.stringify(m.concat(p,i))),e=(new Date).getTime(),y=new Voronoi.Convex(h),n=(new Date).getTime();y.idx<y.pts.length;)y.iterate();return r=(new Date).getTime(),y.grid(),o=(new Date).getTime(),v(),a=(new Date).getTime(),x[0]=x[0]+(e-t),x[1]=x[1]+(n-e),x[2]=x[2]+(r-n),x[3]=x[3]+(o-r),x[4]=x[4]+(a-o),g+=1,console.log(x.map(function(t){return parseInt(t/g)}).join(" "))},w(),M=!1,setTimeout(function(){return M=!0,setInterval(function(){return w()},100)},200)});