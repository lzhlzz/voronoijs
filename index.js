$(document).ready(function(){var t,n,e,r,a,o,u,l,i,c,h,f,d,s,y,v,p,x,g,M,m,b,w,P,q;for(t=1e-10,n=function(t){return t.z=Math.pow(t.x,2)+Math.pow(t.y,2)-t.value,t},e=0,r=function(){return e=P.reduce(function(t,n){return t+n.data},0)},a=1,o=document.getElementById("bound").getBoundingClientRect(),u=o.width,l=o.height,i=d3.select("#svg").attr({width:u+"px",height:l+"px",viewBox:[0,0,u,l].join(" ")}),c=[{x:-u,y:-l,boundary:!0},{x:-u,y:2*l,boundary:!0},{x:2*u,y:-l,boundary:!0},{x:2*u,y:2*l,boundary:!0}].map(function(n){return n.boundary=!0,n.value=t,n}).map(n),h=[{x:10,y:10},{x:u-10,y:10},{x:u-10,y:l-10},{x:10,y:l-10}],f=20,d=[],s=0;f>s;++s)y=s,d.push({x:1*(u/2+u/2*Math.cos(2*Math.PI*y/f)),y:1*(l/2+l/2*Math.sin(2*Math.PI*y/f))});return h=d,v=Polygon.area(h),p=[],x=[],g=function(){return p=w.polygons,p=p.map(function(t){return Voronoi.Polygon.intersect(h,t)})},M=function(){var t,e,o,c;return t=d3.scale.linear().domain([0,u]).range([0,u]),e=d3.scale.linear().domain([0,l]).range([0,l]),o=i.selectAll("path.voronoi").data(p),o.enter().append("path").attr({"class":"voronoi"}),o.exit().remove(),i.selectAll("path.voronoi").attr({d:function(n){var r;return n.length?["M"+t(n[0].x)+" "+e(n[0].y)].concat(function(){var a,o,u=[];for(a=1,o=n.length;o>a;++a)r=a,u.push("L"+t(n[r].x)+" "+e(n[r].y));return u}(),["L"+t(n[0].x)+" "+e(n[0].y)].join(" ")):""},fill:"rgba(0,0,0,0.1)",stroke:"#000"}).on("mouseover",function(){return d3.select(this).attr({fill:"rgba(0,0,0,0.5)"})}).on("mouseout",function(){return d3.select(this).attr({fill:"rgba(0,0,0,0.1)"})}),c=i.selectAll("circle.site").data(P),c.enter().append("circle").attr({"class":"site"}),c.exit().remove(),i.selectAll("circle.site").attr({cx:function(n){return t(n.x)},cy:function(t){return e(t.y)},r:function(t){return Math.sqrt(t.data)},fill:"#fff",stroke:"#000",opacity:function(){return.1}}).on("click",function(t,e){var o,u,l;for(a=1,o=P[e],o.data=Math.pow(Math.sqrt(o.data)+10,2),o.value=o.data,u=0,l=P.length;l>u;++u)e=u,P[e].value=P[e].data,n(P[e]);return r(),n(o),q(),d3.event.preventDefault(),d3.event.stopPropagation(),d3.returnValue=!1,d3.cancelBubble=!0})},i.on("click",function(){var t,e,u;return a=1,t=[d3.event.clientX-o.left,d3.event.clientY-o.top],e=t[0],u=t[1],P.push(n({x:e,y:u,value:30,data:30})),r(),q()}),m=[],i.on("mousemove",function(){var t,e,r;return t=[d3.event.clientX-o.left,d3.event.clientY-o.top],e=t[0],r=t[1],m=n({x:e,y:r,value:30}),q()}),b=[],w=null,P=[],P=function(){var t,n=[];for(t=0;100>t;++t)y=t,n.push({x:u*Math.random(),y:l*Math.random(),value:1+600*Math.random()});return n}().map(function(t){return t.data=t.value,n(t)}),r(),q=function(){var r,a,o,u,l,i,h,f,d,s,y,q,V,J,N,O,S;for(r=0,a=x.length-4;a>r;++r)if(o=r,P[o]&&p[o].length&&!P[o].boundary){for(u=Math.sqrt(P[o].value),l=-1,i=0,h=p[o].length;h>i;++i)f=i,d=p[o][f],s=p[o][(f+1)%p[o].length],y=Math.abs(((s.y-d.y)*P[o].x-(s.x-d.x)*P[o].y+s.x*d.y-s.y*d.x)/Math.sqrt(Math.pow(s.y-d.y,2)+Math.pow(s.x-d.x,2))),(-1===l||l>y)&&(l=y);u=Math.pow(Math.min(u,l),2),P[o].value=u,n(P[o])}for(b=JSON.parse(JSON.stringify(P.concat(m,c))),w=new Voronoi.Convex(b),w.calculate(),g(),r=0,a=x.length-4;a>r;++r)if(o=r,P[o]&&p[o].length&&!P[o].boundary){for(u=P[o].value,q=Polygon.area(p[o]),V=P[o].data/e,J=v*V,N=q,O=Math.sqrt(u),u=Math.sqrt(u)*J/N,l=-1,i=0,h=x.length;h>i;++i)f=i,o!==f&&(S=Math.sqrt(Math.pow(x[f].x-P[o].x,2)+Math.pow(x[f].y-P[o].y,2)),(-1===l||l>S)&&(l=S));u=Math.pow(Math.min(u,l),2),t>u&&(u=t),P[o].value=u,n(P[o])}for(b=JSON.parse(JSON.stringify(P.concat(m,c))),w=new Voronoi.Convex(b),w.calculate(),g(),x=p.map(function(t){return Voronoi.Polygon.center(t)}),r=0,a=x.length-4;a>r;++r)o=r,P[o]&&p[o].length&&!P[o].boundary&&(P[o].x=x[o].x,P[o].y=x[o].y);return M()},b=JSON.parse(JSON.stringify(P.concat(m,c))),w=new Voronoi.Convex(b),w.calculate(),x=p.map(function(t){return Voronoi.Polygon.center(t)}),g(),M(),setTimeout(function(){return setInterval(function(){return q(),a=.99*a},10)},200)});