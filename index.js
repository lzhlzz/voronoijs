$(document).ready(function(){var e,t,n,r,o,a,u,i,l,c,f,s,d,v,h,p;return e=1e-10,t=function(e){return e.z=Math.pow(e.x,2)+Math.pow(e.y,2)-e.value,e},n=function(){var e;return e=d3.max(d.map(function(e){return e.value})),d.forEach(function(t){return t.value=t.value/e*o}),d.map(t)},r=document.getElementById("bound").getBoundingClientRect(),o=r.width,a=r.height,u=d3.select("#svg").attr({width:o+"px",height:a+"px",viewBox:[0,0,o,a].join(" ")}),i=[{x:-o,y:-a,boundary:!0},{x:-o,y:2*a,boundary:!0},{x:2*o,y:-a,boundary:!0},{x:2*o,y:2*a,boundary:!0}].map(function(t){return t.boundary=!0,t.value=e,t}).map(t),l=function(){var e,n,r,i,l,c,f,v,y,g,m,x,w,M;for(e=(new Date).getTime(),n=s.polygons,r=[{x:10,y:10},{x:o-10,y:10},{x:o-10,y:a-10},{x:10,y:a-10}],i=60,l=[],c=0;i>c;++c)f=c,l.push({x:1*(o/2+o/2*Math.cos(2*Math.PI*f/i)),y:1*(a/2+a/2*Math.sin(2*Math.PI*f/i))});if(r=l,n=n.map(function(e){return Voronoi.Polygon.intersect(r,e)}),v=d3.scale.linear().domain([0,o]).range([0,o]),y=d3.scale.linear().domain([0,a]).range([0,a]),g=u.selectAll("path.voronoi").data(n),g.enter().append("path").attr({"class":"voronoi"}),g.exit().remove(),u.selectAll("path.voronoi").attr({d:function(e){var t;return e.length?["M"+v(e[0].x)+" "+y(e[0].y)].concat(function(){var n,r,o=[];for(n=1,r=e.length;r>n;++n)t=n,o.push("L"+v(e[t].x)+" "+y(e[t].y));return o}(),["L"+v(e[0].x)+" "+y(e[0].y)].join(" ")):""},fill:"rgba(0,0,0,0.1)",stroke:"#000"}).on("mouseover",function(){return d3.select(this).attr({fill:"rgba(0,0,0,0.5)"})}).on("mouseout",function(){return d3.select(this).attr({fill:"rgba(0,0,0,0.1)"})}),m=u.selectAll("circle.site").data(d),m.enter().append("circle").attr({"class":"site"}),m.exit().remove(),u.selectAll("circle.site").attr({cx:function(e){return v(e.x)},cy:function(e){return y(e.y)},r:function(e){return Math.sqrt(e.value)},fill:"#fff",stroke:"#000",opacity:function(){return 1}}).on("click",function(e,t){var n;return n=d[t],n.value=Math.pow(Math.sqrt(n.value)+10,2),n.z=Math.pow(n.x,2)+Math.pow(n.y,2)-n.value,h(),d3.event.preventDefault(),d3.event.stopPropagation(),d3.returnValue=!1,d3.cancelBubble=!0}),p)for(x=n.map(function(e){return Voronoi.Polygon.center(e)}),c=0,w=x.length-4;w>c;++c)f=c,d[f]&&n[f].length&&!d[f].boundary&&(d[f].x+=.01*(x[f].x-d[f].x),d[f].y+=.01*(x[f].y-d[f].y),t(d[f]));return M=(new Date).getTime(),console.log("render elapsed: ",M-e)},u.on("click",function(){var e,n,o;return e=[d3.event.clientX-r.left,d3.event.clientY-r.top],n=e[0],o=e[1],d.push(t({x:n,y:o,value:30})),h()}),c=[],u.on("mousemove",function(){var e,n,o;return e=[d3.event.clientX-r.left,d3.event.clientY-r.top],n=e[0],o=e[1],c=t({x:n,y:o,value:30}),h()}),f=[],s=null,d=[],d=function(){var e,t=[];for(e=0;10>e;++e)v=e,t.push({x:Math.random()*o,y:Math.random()*o,value:30+30*Math.random()});return t}().map(function(e){return t(e)}),h=function(){var e,t,n,r,o,a;for(e=(new Date).getTime(),f=JSON.parse(JSON.stringify(d.concat(c,i))),t=(new Date).getTime(),s=new Voronoi.Convex(f),n=(new Date).getTime();s.idx<s.pts.length;)s.iterate();return r=(new Date).getTime(),s.grid(),o=(new Date).getTime(),l(),a=(new Date).getTime(),console.log(t-e,n-t,r-n,o-r,a-o)},h(),p=!1,setTimeout(function(){return p=!0,setInterval(function(){return h()},100)},2e3)});