$(document).ready(function(){var e,t,n,r,a,o,i,l,u,c;e=document.getElementById("bound").getBoundingClientRect(),t=e.width,n=e.height,r=d3.select("#svg").attr({width:t+"px",height:n+"px",viewBox:[0,0,t,n].join(" ")}).on("mousemove",function(){var t,n,r,a;return t=[d3.event.clientX-e.left,d3.event.clientY-e.top],n=t[0],r=t[1],a={x:n,y:r,weight:30,value:30}}).on("click",function(){var t,n,r;if(c)return t=[d3.event.clientX-e.left,d3.event.clientY-e.top],n=t[0],r=t[1],c.sites.push({x:n,y:r,weight:30,value:30})}),a=d3.scale.ordinal().range(["#8c2243","#b22f60","#2957aa","#46d9cd","#34a491","#65ac36","#8e7d2f","#d8a62a","#b6802a","#8a4f36","#b65244"]),o=function(){var e,o,i,l,d,s;return e=d3.scale.linear().domain([0,t]).range([0,t]),o=d3.scale.linear().domain([0,n]).range([0,n]),i=u.getPolygons(),l=u.getSites(),d=r.selectAll("path.voronoi").data(i),d.enter().append("path").attr({"class":"voronoi"}),d.exit().remove(),r.selectAll("path.voronoi").attr({d:function(t){var n;return t&&t.length?["M"+e(t[0].x)+" "+o(t[0].y)].concat(function(){var r,a,i=[];for(r=1,a=t.length;a>r;++r)n=r,i.push("L"+e(t[n].x)+" "+o(t[n].y));return i}(),["L"+e(t[0].x)+" "+o(t[0].y)].join(" ")):""},fill:function(e,t){var n;return l[t]&&0===l[t].lv?(n=d3.rgb(a(l[t].value)),"rgba("+n.r+","+n.g+","+n.b+",0.5)"):"rgba(0,0,0,0.2)"},stroke:function(){return"#000"},"stroke-width":function(e,t){return l[t]&&0===l[t].lv?5:1}}).on("mouseover",function(){return d3.select(this).attr({fill:"rgba(0,0,0,0.5)"})}).on("mouseout",function(){return d3.select(this).attr({fill:"rgba(0,0,0,0.1)"})}),s=r.selectAll("circle.site").data(l.filter(function(e,t){return i[t].length&&!e.boundary})),s.enter().append("circle").attr({"class":"site"}),s.exit().remove(),r.selectAll("circle.site").attr({cx:function(t){return e(t.x)},cy:function(e){return o(e.y)},r:function(e){return Math.sqrt(e.value)},fill:"#fff",stroke:"#000",opacity:function(){return.1}}).on("click",function(e,t){var n;if(c)return n=c.sites[t],n.value=Math.pow(Math.sqrt(n.value)+10,2),n.weight=n.value,c.resetWeight(),d3.event.preventDefault(),d3.event.stopPropagation(),d3.returnValue=!1,d3.cancelBubble=!0})},i=function(e){var t,n,r,a,o,l;if(null==e&&(e=0),t=parseInt(15*Math.random())+2,e>=2)return{value:100*parseInt(2*Math.random())+30,name:Math.random()};for(r=[],a=0;t>a;++a)o=a,r.push(i(e+1));return n=r,l=n.reduce(function(e,t){return e+t.value},0),{children:n,value:l}},l=i(),u=new Voronoi.Treemap(l,Polygon.create(t,n,100),t,n),setInterval(function(){return u.compute(),o()},10)});