function in$(n,r){for(var e=-1,t=r.length>>>0;++e<t;)if(n===r[e])return!0;return!1}var debug,render,convex;debug=!1,render=function(n,r){},convex=function(n,r){function e(n){return n.map(function(n){return h[n]})}function t(n,r){return[d(f,i[n].c).reduce(function(n,r){return n+Math.pow(r,2)},0),r]}function u(n,r){return n[0]-r[0]}var o,i,c,f,a,g,p,d,l,s,h,m,v,b,x,O,y,J,N;for(o=function(){return parseInt(10*Math.random())},i=n.map(function(n){return{pair:[],c:n}}),debug&&console.log(JSON.stringify([0,1,2,3].map(function(n){return i[n].c}))),c=[],f=[],a=function(n){var r,e;return r=[0,1,2].map(function(r){return n[1][r]-n[0][r]}),e=[0,1,2].map(function(r){return n[2][r]-n[0][r]}),[r[1]*e[2]-r[2]*e[1],r[2]*e[0]-r[0]*e[2],r[0]*e[1]-r[1]*e[0]]},g=function(n,r){return[0,1,2].map(function(e){return n[e]*r[e]}).reduce(function(n,r){return n+r},0)},p=function(n,r){var e;return e=g(n.norm,r.c)},f=[0,1,2].map(function(n){return[0,1,2,3].reduce(function(r,e){return r+i[e].c[n]},0)/4}),d=function(n,r){return[0,1,2].map(function(e){return n[e]-r[e]})},l=function(n){var r,e,t,u,o=[];for(r=0,e=n.length;e>r;++r)t=n[r],u=c.indexOf(t),u>=0&&o.push(c.splice(c.indexOf(t),1));return o},s=function(n){var r,e,t,u,o,p,l,s,h;for(r=n.map(function(n){return i[n]}),e=a(r.map(function(n){return n.c})),t=g(e,d(f,r[0].c)),t>0&&(e=e.map(function(n){return-n}),u=r[0],r[0]=r[2],r[2]=u,u=n[0],n[0]=n[2],n[2]=u),c.push(o={idx:n,pts:r,norm:e,pair:[]}),p=0,s=(l=i).length;s>p;++p)h=l[p],g(o.norm,d(h.c,o.pts[0].c))>0&&(o.pair.push(h),h.pair.push(o));return 0===t&&(o.degenerate=!0),o},h=[0,1,2,3],m=4,debug&&console.log(i.length);m<i.length;){for(v=0,x=(b=[[0,1,2],[0,1,3],[0,2,3],[1,2,3]].map(e)).length;x>v;++v)O=b[v],y=s(O);if(!y.degenerate)break;O=h.map(t).sort(u)[0][1],h.splice(h.indexOf(O),1),h.push(m),m++}for(J=function(n){var r,e,t,u,o,f,a,g,p,d,h,m,v,b,x=[];for(c.map(function(n){return n.active=!1}),r=i[n].pair,e=[],t=[],debug&&console.log("adding: ("+n+") ",JSON.stringify(i[n].c)),debug&&console.log("light face: ",JSON.stringify(r.map(function(n){return n.idx}))),u=0,o=r.length;o>u;++u)if(f=r[u],in$(f,c))for(a=0;3>a;++a){for(g=a,p=[f.idx[g],f.idx[(g+1)%3]],p[0]>p[1]&&p.sort(),d=!1,h=0,m=e.length;m>h;++h)if(v=e[h],p[0]===v[0]&&p[1]===v[1]){v.dup=!0,d=!0;break}d||e.push(p)}for(u=0,o=e.length;o>u;++u)p=e[u],p.dup||t.push(p);for(l(r),debug&&console.log("removed faces",JSON.stringify(r.map(function(n){return n.idx}))),debug&&console.log("light edge: ",t),render(i,t),u=0,o=t.length;o>u;++u)p=t[u],b=p.concat([n]),f=s(b),debug&&console.log("adding face",JSON.stringify(f.idx)),x.push(f.active=!0);return x},v=m,N=i.length;N>v;++v)O=v,J(O);return r(c)};