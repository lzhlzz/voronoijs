function in$(t,e){for(var n=-1,r=e.length>>>0;++n<r;)if(t===e[n])return!0;return!1}$(document).ready(function(){var t,e,n,r,a,o,l,c,i,u,x,y;for(t=document.getElementById("svg"),e=d3.select(t),n=t.getBoundingClientRect(),r=n.width,a=n.height,r=a,window.xscale=o=d3.scale.linear().domain([0,1]).range([20,r-20]),window.yscale=l=d3.scale.linear().domain([0,1]).range([a-20,20]),window.rscale=l=d3.scale.linear().domain([0,1]).range([0,r]),e.attr({viewBox:[0,0,r,a].join(" ")}),i=[],u=0;8>u;++u)x=u,i.push({x:Math.random(),y:Math.random(),value:.02*Math.random()+.01});return c=i,y=e.selectAll("circle.site").data(c),y.enter().append("circle").attr({"class":"site",cx:function(t){return o(t.x)},cy:function(t){return l(t.y)},r:function(t){return rscale(t.value)},fill:function(t){return"rgba(0,0,0,"+(Math.pow(t.x,2)+Math.pow(t.y,2)-t.value)+")"},stroke:"#000"}),e.selectAll("text").data(c).enter().append("text").attr({"class":"site",x:function(t){return o(t.x)},y:function(t){return l(t.y)},dy:20,dx:-20,"text-anchor":"middle","dominant-baseline":"central"}).text(function(t,e){return e}),convex(c.map(function(t){return[t.x,t.y,Math.pow(t.x,2)+Math.pow(t.y,2)-t.value]}),function(t){function n(t){return in$($,t.idx)?!0:!1}var r,a,i,u,x,y,s,p,h,d,f,g,w,M,v,m,k,A,b,B,$,j,L,C;for(console.log(c.length,t.length),r=[],a=[],i=0,u=t.length;u>i;++i)x=t[i],y=x.pts[0].c,s=y[0],p=y[1],h=y[2],y=x.pts[1].c,d=y[0],f=y[1],g=y[2],y=x.pts[2].c,w=y[0],M=y[1],v=y[2],a.push([[s,p,h],[d,f,g],x.active]),a.push([[s,p,h],[w,M,v],x.active]),a.push([[d,f,g],[w,M,v],x.active]);if(m=!0,null!=m&&(k=e.selectAll("line.edge").data(a),k.enter().append("line").attr({"class":"edge"}),k.exit().remove(),e.selectAll("line.edge").attr({x1:function(t){return o(t[0][0])},y1:function(t){return l(t[0][1])},x2:function(t){return o(t[1][0])},y2:function(t){return l(t[1][1])},stroke:function(){return"rgba(0,0,0,0.1)"},"stroke-width":2})),A=function(t){var e,n,r,a,o,l,c,i,u,x,y,s,p,h,d,f,g,w,M,v,m,k;for(e=[],n=0,r=t.length;r>n;++n)a=t[n],o=a.pts[0].c,l=o[0],c=o[1],i=o[2],o=a.pts[1].c,u=o[0],x=o[1],y=o[2],o=a.pts[2].c,s=o[0],p=o[1],h=o[2],d=c*(y-h)+x*(h-i)+p*(i-y),f=i*(u-s)+y*(s-l)+h*(l-u),g=l*(x-p)+u*(p-c)+s*(c-x),w=l*(x*h-p*y)+u*(p*i-c*h)+s*(c*y-x*i),M=-(d/g)/2,v=-(f/g)/2,m=w/g,e.push({x:M,y:v});return k=e.reduce(function(t,e){return{x:t.x+e.x,y:t.y+e.y}},{x:0,y:0}),k.x=k.x/e.length,k.y=k.y/e.length,e.sort(function(t,e){var n,r,a,o,l,c,i,u,x;return n=Math.pow(k.x,2)+Math.pow(k.y,2),r=Math.pow(t.x-k.x,2)+Math.pow(t.y-k.y,2),a=Math.pow(e.x-k.x,2)+Math.pow(e.y-k.y,2),o=Math.pow(t.x-k.y,2)+Math.pow(t.y-k.x,2),l=Math.pow(e.x-k.y,2)+Math.pow(e.y-k.x,2),c=(-k.x*(t.x-k.x)+-k.y*(t.y-k.y))/(n*r),i=(-k.x*(e.x-k.x)+-k.y*(e.y-k.y))/(n*a),u=(-k.y*(t.x-k.y)+-k.x*(t.y-k.x))/(n*o),x=(-k.y*(e.x-k.y)+-k.x*(e.y-k.x))/(n*l),0>u&&(c=-c-2),0>x&&(i=-i-2),c-i}),e},b=!0,null!=b){for(B=[],i=0,u=(y=c).length;u>i;++i){$=i,j=y[i],L=t.filter(n),console.log($,L.length),B.push(A(L));break}return C=e.selectAll("path.polygon").data(B),C.enter().append("path").attr({"class":"polygon"}),C.exit().remove(),e.selectAll("path.polygon").attr({d:function(t){return["M"+o(t[0].x)+" "+l(t[0].y)].concat(t.map(function(t){return"L"+o(t.x)+" "+l(t.y)}),["L"+o(t[0].x)+" "+l(t[0].y)]).join(" ")},fill:"none",stroke:"#00f","stroke-width":2})}})});