function in$(n,r){for(var e=-1,t=r.length>>>0;++e<t;)if(n===r[e])return!0;return!1}var debug,render,convex;debug=!1,render=function(n,r){},convex=function(n,r){function e(n){return n.map(function(n){return l[n]})}function t(n,r){return[d(f,i[n].c).reduce(function(n,r){return n+Math.pow(r,2)},0),r]}function u(n,r){return n[0]-r[0]}var o,i,c,f,a,g,d,p,s,l,h,m,v,b,x,O,y,J;for(o=function(){return parseInt(10*Math.random())},i=n.map(function(n){return{pair:[],c:n}}),debug&&console.log(JSON.stringify([0,1,2,3].map(function(n){return i[n].c}))),c=[],f=[],a=function(n,r){return[0,1,2].map(function(e){return n[e]*r[e]}).reduce(function(n,r){return n+r},0)},g=function(n,r){var e;return e=a(n.norm,r.c)},f=[0,1,2].map(function(n){return[0,1,2,3].reduce(function(r,e){return r+i[e].c[n]},0)/4}),d=function(n,r){return[0,1,2].map(function(e){return n[e]-r[e]})},p=function(n){var r,e,t,u,o=[];for(r=0,e=n.length;e>r;++r)t=n[r],u=c.indexOf(t),u>=0&&o.push(c.splice(c.indexOf(t),1));return o},s=function(n){var r,e,t,u,o,g,p,s,l;for(r=n.map(function(n){return i[n]}),e=cross(r.map(function(n){return n.c})),t=a(e,d(f,r[0].c)),t>0&&(e=e.map(function(n){return-n}),u=r[0],r[0]=r[2],r[2]=u,u=n[0],n[0]=n[2],n[2]=u),c.push(o={idx:n,pts:r,norm:e,pair:[]}),g=0,s=(p=i).length;s>g;++g)l=p[g],a(o.norm,d(l.c,o.pts[0].c))>0&&(o.pair.push(l),l.pair.push(o));return 0===t&&(o.degenerate=!0),o},l=[0,1,2,3],h=4,debug&&console.log(i.length);h<i.length;){for(m=0,b=(v=[[0,1,2],[0,1,3],[0,2,3],[1,2,3]].map(e)).length;b>m;++m)x=v[m],O=s(x);if(!O.degenerate)break;x=l.map(t).sort(u)[0][1],l.splice(l.indexOf(x),1),l.push(h),h++}for(y=function(n){var r,e,t,u,o,f,a,g,d,l,h,m,v,b,x=[];for(c.map(function(n){return n.active=!1}),r=i[n].pair,e=[],t=[],debug&&console.log("adding: ("+n+") ",JSON.stringify(i[n].c)),debug&&console.log("light face: ",JSON.stringify(r.map(function(n){return n.idx}))),u=0,o=r.length;o>u;++u)if(f=r[u],in$(f,c))for(a=0;3>a;++a){for(g=a,d=[f.idx[g],f.idx[(g+1)%3]],d[0]>d[1]&&d.sort(),l=!1,h=0,m=e.length;m>h;++h)if(v=e[h],d[0]===v[0]&&d[1]===v[1]){v.dup=!0,l=!0;break}l||e.push(d)}for(u=0,o=e.length;o>u;++u)d=e[u],d.dup||t.push(d);for(p(r),debug&&console.log("removed faces",JSON.stringify(r.map(function(n){return n.idx}))),debug&&console.log("light edge: ",t),render(i,t),u=0,o=t.length;o>u;++u)d=t[u],b=d.concat([n]),f=s(b),debug&&console.log("adding face",JSON.stringify(f.idx)),x.push(f.active=!0);return x},m=h,J=i.length;J>m;++m)x=m,y(x);return r(c)};