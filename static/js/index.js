$(document).ready(function(){var e,t,n,r,a,u,l,o,i,c,v,d,s;e=document.getElementById("demonstration").getBoundingClientRect(),t=e.width,n=e.height,r=d3.select("#svg").attr({width:t+"px",height:n+"px",viewBox:[-10,-10,t+20,n+20].join(" ")}).on("mousemove",function(){var t,n,r,a;return t=[d3.event.clientX-e.left,d3.event.clientY-e.top],n=t[0],r=t[1],a={x:n,y:r,weight:30,value:30}}).on("click",function(){var t,n,r;if(s)return t=[d3.event.clientX-e.left,d3.event.clientY-e.top],n=t[0],r=t[1],s.sites.push({x:n,y:r,weight:30,value:30})}),a=d3.scale.ordinal().range(["#f381cf","#c775e1","#907bdb","#81b1da","#a9e0ea","#8ebc1a","#e3a735","#d47b11","#c34128"]),u=function(){var e,l,o,i,c,v;return e=d3.scale.linear().domain([0,t]).range([0,t]),l=d3.scale.linear().domain([0,n]).range([0,n]),o=d.getPolygons(),i=d.getSites(),c=r.selectAll("path.voronoi").data(o),c.enter().append("path").attr({"class":"voronoi"}),c.exit().remove(),r.selectAll("path.voronoi").attr({d:function(t){var n;return t&&t.length?["M"+e(t[0].x)+" "+l(t[0].y)].concat(function(){var r,a,u=[];for(r=1,a=t.length;a>r;++r)n=r,u.push("L"+e(t[n].x)+" "+l(t[n].y));return u}(),["L"+e(t[0].x)+" "+l(t[0].y)].join(" ")):""},fill:function(e,t){var n;return i[t]&&0===i[t].lv?(n=d3.rgb(a(t)),"rgba("+n.r+","+n.g+","+n.b+",1.0)"):"rgba(0,0,0,0.0)"},stroke:function(){return"#000"},"stroke-width":function(e,t){return i[t]&&0===i[t].lv?5:1}}).on("mouseover",function(){return d3.select(this).attr({fill:"rgba(0,0,0,0.5)"})}).on("mouseout",function(){return d3.select(this).attr({fill:"rgba(0,0,0,0.1)"})}).on("click",function(e,t){return i[t].value+=1e3,setTimeout(function(){return d.updateValue(),u()},0)}),v=r.selectAll("circle.site").data(i.filter(function(e,t){return o[t].length&&!e.boundary&&!e.children})),v.enter().append("circle").attr({"class":"site"}),v.exit().remove(),r.selectAll("circle.site").attr({cx:function(t){return e(t.x)},cy:function(e){return l(e.y)},r:function(e){return Math.sqrt(e.value)},fill:"#fff",stroke:"#000",opacity:function(){return.1}}).on("click",function(e,t){var n;return e.value+=1e3,setTimeout(function(){return d.updateValue(),u()},0),s?(n=s.sites[t],n.value=Math.pow(Math.sqrt(n.value)+10,2),n.weight=n.value,s.resetWeight(),d3.event.preventDefault(),d3.event.stopPropagation(),d3.returnValue=!1,d3.cancelBubble=!0):void 0})},l=function(e){var t,n,r,a,u,o;if(null==e&&(e=0),t=parseInt(8*Math.random())+2,0===e&&(t=8),1===e&&(t=4),2===e&&(t=4),e>=3)return{value:100*parseInt(2*Math.random())+30,name:Math.random()};for(r=[],a=0;t>a;++a)u=a,r.push(l(e+1));return n=r,o=n.reduce(function(e,t){return e+t.value},0),{children:n,value:o}},o=l(),i={children:[{value:2001},{value:2002},{value:2003}],value:6006},c={children:[{value:31},{value:32},{value:2003}],value:2066},v={children:[i,c],value:8072},d=new Voronoi.Treemap(o,Polygon.create(t,n,100),t,n),setInterval(function(){return d.compute(),u()},50)});