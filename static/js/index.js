$(document).ready(function(){var e,t,n,r,a,l,u,o,i,c,v,d,s;e=document.getElementById("bound").getBoundingClientRect(),t=e.width,n=e.height,r=d3.select("#svg").attr({width:t+"px",height:n+"px",viewBox:[0,0,t,n].join(" ")}).on("mousemove",function(){var t,n,r,a;return t=[d3.event.clientX-e.left,d3.event.clientY-e.top],n=t[0],r=t[1],a={x:n,y:r,weight:30,value:30}}).on("click",function(){var t,n,r;if(s)return t=[d3.event.clientX-e.left,d3.event.clientY-e.top],n=t[0],r=t[1],s.sites.push({x:n,y:r,weight:30,value:30})}),a=d3.scale.ordinal().range(["#8c2243","#b22f60","#2957aa","#46d9cd","#34a491","#65ac36","#8e7d2f","#d8a62a","#b6802a","#8a4f36","#b65244"]),l=function(){var e,l,u,o,i,c;return e=d3.scale.linear().domain([0,t]).range([0,t]),l=d3.scale.linear().domain([0,n]).range([0,n]),u=d.getPolygons(),o=d.getSites(),i=r.selectAll("path.voronoi").data(u),i.enter().append("path").attr({"class":"voronoi"}),i.exit().remove(),r.selectAll("path.voronoi").attr({d:function(t){var n;return t&&t.length?["M"+e(t[0].x)+" "+l(t[0].y)].concat(function(){var r,a,u=[];for(r=1,a=t.length;a>r;++r)n=r,u.push("L"+e(t[n].x)+" "+l(t[n].y));return u}(),["L"+e(t[0].x)+" "+l(t[0].y)].join(" ")):""},fill:function(e,t){var n;return o[t]&&0===o[t].lv?(n=d3.rgb(a(o[t].value)),"rgba("+n.r+","+n.g+","+n.b+",0.5)"):"rgba(0,0,0,0.2)"},stroke:function(){return"#000"},"stroke-width":function(e,t){return o[t]&&0===o[t].lv?5:1}}).on("mouseover",function(){return d3.select(this).attr({fill:"rgba(0,0,0,0.5)"})}).on("mouseout",function(){return d3.select(this).attr({fill:"rgba(0,0,0,0.1)"})}),c=r.selectAll("circle.site").data(o.filter(function(e,t){return u[t].length&&!e.boundary})),c.enter().append("circle").attr({"class":"site"}),c.exit().remove(),r.selectAll("circle.site").attr({cx:function(t){return e(t.x)},cy:function(e){return l(e.y)},r:function(e){return Math.sqrt(e.value)},fill:"#fff",stroke:"#000",opacity:function(){return.1}}).on("click",function(e,t){var n;if(s)return n=s.sites[t],n.value=Math.pow(Math.sqrt(n.value)+10,2),n.weight=n.value,s.resetWeight(),d3.event.preventDefault(),d3.event.stopPropagation(),d3.returnValue=!1,d3.cancelBubble=!0})},u=function(e){var t,n,r,a,l,o;if(null==e&&(e=0),t=parseInt(8*Math.random())+2,e>=3)return{value:100*parseInt(2*Math.random())+30,name:Math.random()};for(r=[],a=0;t>a;++a)l=a,r.push(u(e+1));return n=r,o=n.reduce(function(e,t){return e+t.value},0),{children:n,value:o}},o=u(),i={children:[{value:2001},{value:2002},{value:2003}],value:6006},c={children:[{value:31},{value:32},{value:2003}],value:2066},v={children:[i,c],value:8072},d=new Voronoi.Treemap(o,Polygon.create(t,n,100),t,n),setInterval(function(){return d.compute(),l()},100)});